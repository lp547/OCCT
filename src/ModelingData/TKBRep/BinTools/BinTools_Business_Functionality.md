# BinTools 业务功能说明

## 1. 模块概述
**BinTools** 是 Open CASCADE Technology (OCCT) 核心库中的一个关键模块，位于 `ModelingData` 组件下的 `TKBRep` 库中。它的主要业务功能是提供**BRep (Boundary Representation) 模型数据的二进制持久化**能力。

简单来说，它负责将内存中复杂的 3D 模型（拓扑结构 + 几何数据）高效地保存到磁盘文件中（序列化），以及将这些文件重新读取回内存中（反序列化）。与文本格式（如 BREP 格式）相比，二进制格式通常具有更小的文件体积和更快的读写速度，适合工程应用中的中间数据存储和交换。

## 2. 核心业务价值

### 2.1 高效的数据存储 (Compact Storage)
工业级 CAD 模型通常包含成千上万个面、边和顶点。BinTools 通过二进制编码，避免了文本格式中浮点数转字符串的精度损失和体积膨胀。
*   **空间优化**：通过 `ShapeSet` 的设计，它会对模型中的几何对象（曲面、曲线）和位置变换（Location）进行去重。如果一个模型中多次引用了同一个基础曲面（例如阵列特征），BinTools 只会存储一次该曲面的定义，后续通过索引引用，极大地压缩了存储空间。

### 2.2 数据完整性与精度 (Data Integrity)
*   **无损保存**：二进制格式直接存储计算机内存中的浮点数表示（IEEE 754），避免了文本转换带来的精度截断问题，确保模型在保存和重新读取后几何精度完全一致。
*   **复杂属性支持**：支持保存模型的三角网格（Triangulation）、法线（Normals）以及多边形近似数据（Polygons），这对于可视化和有限元分析等下游业务至关重要。

### 2.3 版本兼容性 (Versioning)
*   随着 OCCT 版本的更新，模型数据的定义可能会发生变化（例如增加新的几何类型或属性）。BinTools 提供了版本控制机制（`BinTools_FormatVersion`），允许旧版本的软件读取新版本生成的兼容数据，或者新版本软件正确解析旧有的归档数据，保证了业务数据的长期可用性。

### 2.4 流式处理能力 (Streaming)
*   引入了 `BinTools_ShapeReader` 和 `BinTools_ShapeWriter` 后，模块支持了更灵活的流式读写模式。这对于网络传输 CAD 数据或处理超大规模模型（无法一次性完全加载到内存）的业务场景提供了基础支持。

## 3. 典型应用场景

1.  **项目文件保存 (.bin, .cbf)**
    *   CAD 软件在用户点击“保存”时，利用 BinTools 将当前的编辑状态快速写入磁盘。
2.  **撤销/重做机制 (Undo/Redo)**
    *   在内存中利用二进制流快速序列化当前模型状态，以便在用户需要撤销操作时快速恢复。
3.  **进程间通信 (IPC)**
    *   在不同的计算进程间交换几何数据时，使用二进制格式作为传输协议，减少序列化开销。
4.  **数据库存储**
    *   将 CAD 模型作为二进制大对象 (BLOB) 存储在数据库中，用于PLM（产品生命周期管理）系统。

## 4. 业务流程简述

### 写入流程 (Export/Serialize)
1.  **输入**：用户提供一个 `TopoDS_Shape` 对象（如一个零件或装配体）。
2.  **收集**：工具遍历该形状，识别出所有的几何元素（点、线、面）和拓扑结构。
3.  **索引**：对几何元素建立索引表，剔除重复项。
4.  **编码**：将整数、浮点数、布尔值等基础数据按特定字节序写入流。
5.  **输出**：生成二进制数据流或文件。

### 读取流程 (Import/Deserialize)
1.  **输入**：用户提供二进制数据流或文件路径。
2.  **解析头信息**：读取文件头，确认格式版本。
3.  **重建表**：读取几何表和位置表，在内存中重建几何对象。
4.  **重建拓扑**：根据拓扑结构描述，引用已重建的几何对象，组装出最终的 `TopoDS_Shape`。
5.  **输出**：返回完整的形状对象供应用程序使用。
